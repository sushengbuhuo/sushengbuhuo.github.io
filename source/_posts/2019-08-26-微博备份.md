---
title: 微博备份
date: 2019-08-26 20:09:02
tags:
- 公众号
---
这是一篇旧文。
玩微博 5 年了，至今发布微博 66747 条，前几天微博突然挂了，而且最近微博管控越来越严格了，为了安全把我的 5 年微博备份下，使用的工具是一个 chrome 插件 

![image](https://upload-images.jianshu.io/upload_images/17817191-31d86e4d0f89789b?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![image](https://upload-images.jianshu.io/upload_images/17817191-840803c8c8522b55?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

具体使用教程见这条微博 http://weibo.com/1869328492/F9cR9okDK?type=comment#_rnd1498388083394 扩展见微盘 http://vdisk.weibo.com/s/x5GuwUhlGH/1498206615 由于 chrome 扩展安装需要翻(fan)墙(qiang)，所以作者提供的是 crx 文件，下载后拖到扩展里就可以安装 感谢作者@Easy

一、下载后，拖入chrome扩展页安装。

二、点击工具图标进入操作页面，微信扫码登录。这时注意一下，先打开weibo.com登录你的微博。这里登录后，下面一步weibo.cn时会自动登录，因为weibo.cn的登录很麻烦，所以这里要先登录。

三、会看到【点我测试我的微博网络】，点它，打开weibo.cn。返回工具页面，点【登录后点此继续】。这里要注意一下，在打开的weibo.cn页面，下拉到最底下，看到条数，点开，设置20。点预览，后点保存设置。返回工具页面，再点【全量备份】。微博越多速度越慢。如果你发现数字不动了，点一下图标，即可开新页，会看到可以继续，

四、完成后，会自动进入预览效果页面。会有一个下载按钮。点下载即可。

五、会得到一个压缩包，解压后，就是N个html文件，这就是把你的微博备份了。

下载后的文件打开若有乱码，则更新浏览器。

![image](https://upload-images.jianshu.io/upload_images/17817191-fb46a68d5b039e27?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240) 

从早上 9 点就开始备份了，然后我的微博数实在太大了， 共 66741 条 6675 页微博需要备份，预计需要 166 分钟，作者都惊呆了，鬼知道我都发了些什么微博。

![image](https://upload-images.jianshu.io/upload_images/17817191-67b9033855e22bc5?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![image](https://upload-images.jianshu.io/upload_images/17817191-f190ca7fbf413be2?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![image](https://upload-images.jianshu.io/upload_images/17817191-e2cff78bafc765b9?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![image](https://upload-images.jianshu.io/upload_images/17817191-16ba9fed891acfa7?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![image](https://upload-images.jianshu.io/upload_images/17817191-e2815558f34efd09?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

最后还是微信上@easy 直接帮我导出了，感谢。

![image](https://upload-images.jianshu.io/upload_images/17817191-91f9adbd635099ae?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

作者还给懂PHP的同学提供两个微贝的增强脚本，解压后放到那堆html 同级目录，运行 php json.php 会把feed数据提取到json目录，运行 php img.php 可以把页面中的图片备份到本地并替换链接。http://vdisk.weibo.com/s/x5GuwUhQQ_/1498322627 
```js
$ cat json.php

<?php

foreach( glob(  '*.html' ) as $k => $htmlfile )

{

        echo "File $htmlfile ...";

        $reg = '/this\.feeds\s+=\s+(.+?)\}\s+,\s+1000/is';

        $content = file_get_contents( $htmlfile );

        if( preg_match( $reg , $content , $out ) )

        {

                if($data = json_decode( trim($out[1]) , 1 ))

                {

                        @mkdir( 'json/', 0777 , true  );

                        $jsonfile = 'json/'  . basename( $htmlfile ) . '.json';

                        file_put_contents( $jsonfile , trim($out[1]) );

                        echo "done.\r\n";

                }

                else

                        echo "error.\r\n";

        }

}

echo "ALL Done.";

$ cat img.php

<?php

foreach( glob(  '*.html' ) as $k => $htmlfile )

{

        echo "File: $htmlfile \r\n";

        $reg = '/this\.feeds\s+=\s+(.+?)\}\s+,\s+1000/is';

        $content = file_get_contents( $htmlfile );

        if( preg_match( $reg , $content , $out ) )

        {

                if($data = json_decode( trim($out[1]) , 1 ))

                {

                        foreach ( $data as $kkk => $item )

                        {

                                $keys = array();

                                $keys[] = 'pic_url';

                                //$keys[] = 'oripic_url';

                                $keys[] = 'rt_pic_url';

                                //$keys[] = 'rt_oripic_url';

                                foreach( $keys as $key )

                                {

                                        if( strlen( $item[$key] ) > 0 && (substr

( $item[$key] , 0 , 7 ) == 'http://' || substr( $item[$key] , 0 , 8 ) == 'https:

//' ) )

                                        {

                                                $info = explode( '.' , basename(

 $item[$key] ));

                                                $ext = end( $info );

                                                if( !in_array(  $ext , array( 'p

ng' , 'jpg' , 'jpeg' , 'gif' ) ) )

                                                {

                                                        $ext = 'jpg';

                                                }

                                                @mkdir( 'img/' . $k . '/' , 0777

 , true  );

                                                $newfile = 'img/' . $k . '/' . $

item['cid'] . '.'.$key.'.' .$ext;

                                                echo "Image: " . $item[$key] . "

\r\n" ;

                                                if( copy( $item[$key] , $newfile

 ) )

                                                {

                                                        $data[$kkk][$key] = $new

file;

                                                        // 处理原图

                                                        if( $key == 'rt_pic_url'

 )

                                                        {

                                                                $new_ofile = 'im

g/' . $k . '/' . $item['cid'] . '.'.$key.'.rtori.' .$ext;

                                                                $nurl = str_repl

ace( '/wap180/' , '/large/',  $item[$key] );

                                                                echo "Image: " .

 $nurl . "\r\n" ;

                                                                if( copy( $nurl

, $new_ofile ) )

                                                                        $data[$k

kk]['rt_oripic_url'] = $new_ofile;

                                                        }

                                                        // 处理原图

                                                        if( $key == 'pic_url' )

                                                        {

                                                                $new_ofile = 'im

g/' . $k . '/' . $item['cid'] . '.'.$key.'.ori.' .$ext;

                                                                $nurl = str_repl

ace( '/wap180/' , '/large/',  $item[$key] );

                                                                echo "Image: " .

 $nurl . "\r\n" ;

                                                                if( copy( $nurl

, $new_ofile ) )

                                                                        $data[$k

kk]['oripic_url'] = $new_ofile;

                                                        }

                                                        echo "...done\r\n";

                                                }

                                                else

                                                {

                                                        echo "...error \r\n";

                                                }

                                                echo "@Page $k \r\n";

                                        }

                                }

                        }

                        $content = str_replace( $out[1] , json_encode( $data ) ,

 $content );

                        file_put_contents( $htmlfile , $content );

                }

        }

}

echo "All Done!";
```
最后导出目录下 92 MB，130 个 HTML 文件

![image](https://upload-images.jianshu.io/upload_images/17817191-8710b4265070a3af?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![image](https://upload-images.jianshu.io/upload_images/17817191-5fccdc9d65f53a2c?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

最后推荐几个好用的 chrome 插件 https://chrome.google.com/webstore/category/extensions?hl=zh-CN

![image](https://upload-images.jianshu.io/upload_images/17817191-9540d2be9a11fd32?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![image](https://upload-images.jianshu.io/upload_images/17817191-881095e91cb65fd7?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

不过安装 chrome 扩展，你懂的，在墙外，所以需要用软件，比如最常用的 ss,教程见 http://www.iyingsuo.com/help.html

![image](https://upload-images.jianshu.io/upload_images/17817191-380ba448a97e72c7?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

油猴脚本Violent monkey https://greasyfork.org/zh-CN 安装这个脚本后访问指定的网址就可以了。

![image](https://upload-images.jianshu.io/upload_images/17817191-feff8a76a80f732c?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
