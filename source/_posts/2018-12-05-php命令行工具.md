---
title: php命令行工具
date: 2018-12-05 21:00:44
tags:
- php
- 命令行
- 工具
---
### composer镜像
composer全局安装的命令路径 C:\Users\xxx\AppData\Roaming\Composer\vendor\bin
```javascript
composer global require slince/composer-registry-manager
$ composer repo:ls
   composer       https://packagist.org
   phpcomposer    https://packagist.phpcomposer.com
   composer-proxy https://packagist.composer-proxy.org
 * laravel-china  https://packagist.laravel-china.org
   cnpkg          https://php.cnpkg.org
composer repo:use laravel-china
composer require 安装的时候可能会把.git目录也下载了，因为木有php-zip扩展，所以使用的git clone 来下载，默认是wget

要列出所有已安装的包及其版本号和说明，只需使用 show:

composer show
有时候把这些信息用依赖关系树的形式查看会更容易理解， 可以通过 --tree or -t 参数:

composer show -t
如果要筛选返回的包，可以使用通配符传递一个额外的字符串参数 *:
composer show -t
acacha/admin-lte-template-laravel 1.0.5 AdminLTE template applied to Laravel Scaffolding
├──illuminate/console ~5.0
├──illuminate/support ~5.0
└──php >=5.4.0
baum/baum 1.1.1 Baum is an implementation of the Nested Set pattern for Eloquent models.
├──illuminate/console 5.*
├──illuminate/database 5.*
├──illuminate/events 5.*
├──illuminate/filesystem 5.*
├──illuminate/support 5.*
└──php >=5.4.0
cloudmario/scs dev-master PHP SDK for 新浪云存储
└──php >=5.2.0
firephp/firephp-core v0.4.0 Traditional FirePHPCore library for sending PHP variables to the browser.
guzzlehttp/guzzle 5.3.1 Guzzle is a PHP HTTP client library and framework for building RESTful web service clients
├──guzzlehttp/ringphp ^1.1
│  ├──guzzlehttp/streams ~3.0
│  │  └──php >=5.4.0
│  ├──php >=5.4.0
│  └──react/promise ~2.0
│     └──php >=5.4.0
└──php >=5.4.0
jenssegers/mongodb v2.1.9 A MongoDB based Eloquent model and Query builder for Laravel 4
├──illuminate/container ^5.0
├──illuminate/database ^5.0
├──illuminate/events ^5.0
├──illuminate/support ^5.0
└──php >=5.4.0


composer show 'symfony/*'
如果要查看有关特定包的信息，需要完整包名:

$ composer show laravel/framework
name     : laravel/framework
descrip. : The Laravel Framework.
keywords : framework, laravel
versions : * v5.0.16
type     : library
license  : MIT License (MIT) (OSI approved) https://spdx.org/licenses/MIT.html#licenseText
source   : [git] https://github.com/laravel/framework.git 861a1e78c84dca82fe4bd85d00349c52304eea77
dist     : [zip] https://api.github.com/repos/laravel/framework/zipball/861a1e78c84dca82fe4bd85d00349c52304eea77 861a1e78c84dca82fe4bd85d00349c52304eea77


如果您想知道安装特定软件包的原因，可以使用 why 命令来确定哪些依赖项需要它：

composer why vlucas/phpdotenv
composer why vlucas/phpdotenv -t

使用 --verbose 或 -v 参数来查看本地修改的软件包和文件：

composer status -v

$ composer licenses
Name: laravel/laravel
Version: dev-dev_wzp
Licenses: MIT
Dependencies:

Name                                   Version             License
acacha/admin-lte-template-laravel      1.0.5               MIT
bacon/bacon-qr-code                    1.0.1               BSD-2-Clause
baum/baum                              1.1.1               MIT
classpreloader/classpreloader          1.2.0               MIT
cloudmario/scs                         dev-master 5294387  MIT

检测一下已安装的包，哪些有可以升级的。这可以使用 outdated 命令。

composer outdated
acacha/admin-lte-template-laravel     1.0.5              6.0
bacon/bacon-qr-code                   1.0.1              2.0.0
classpreloader/classpreloader         1.2.0              3.2.0
cloudmario/scs                        dev-master 5294387 dev-master 4610269
danielstjules/stringy                 1.9.0              3.1.0
doctrine/inflector                    v1.0.1             v1.3.0
doctrine/instantiator                 1.0.5              1.2.0
evenement/evenement                   v2.0.0             v3.0.1
guzzlehttp/guzzle                     5.3.1              6.3.3
guzzlehttp/psr7                       1.3.1              1.5.2

Laravel 最近发布了一个新的 5.8 版本的框架；我们可以使用 why-not 命令检查任何阻止我们更新 laravel/framework 包的包：

composer why-not laravel/framework 5.8

如果您想知道安装特定软件包的原因，可以使用 why 命令来确定哪些依赖项需要它：

composer why vlucas/phpdotenv
laravel/framework  v5.0.16  requires  vlucas/phpdotenv (~1.0)
https://learnku.com/laravel/t/28678 


```
### 多线程下载composer
```javascript
国内源搭配多线程下载composer
composer global require hirak/prestissimo
composer create-project laravel/laravel laravel1 --no-progress --profile --prefer-dist
https://github.com/hirak/prestissimo
```
### httpstat
```javascript
$ git clone https://github.com/talhasch/php-httpstat
$ cd php-httpstat
$ cp httpstat.php /usr/local/bin/httpstat
$ chmod +x /usr/local/bin/httpstat
 

$ httpstat http://www.google.com
```
### PHP 静态代码分析phan
```javascript
https://laravel-china.org/topics/19011 https://github.com/nunomaduro/larastan https://laravel-china.org/topics/20768

git clone https://github.com/nikic/php-ast
cd php-ast/
phpize
sudo ./configure --with-php-config=/php7/bin/php-config --enable-ast
sudo make
sudo make install
php7 --ini
vi /etc/php.ini 
extension = ast.so
# 就能看到扩展啦
php -m | grep ast
curl -sS https://getcomposer.org/installer | php7
mkdir test
cd test
which php
$ composer config -g repo.packagist composer https://packagist.laravel-china.org

php7 /usr/bin/composer require --dev "phan/phan:1.x"
vi src/a.php
   
   <?php
   
   class A extends B
   {
       public function a1()
       {
           return $this->a2(1);
       }
   
       /**
        * @param array $b
        *
        * @return int
        */
       private function a2($b)
       {
           return $b + 1;
       }
   }
   写个shell脚本 vi test.sh 
   
   #!/bin/bash
   
   function log()
   {
       echo -e -n "\033[01;35m[YUNQI] \033[01;31m"
       echo $@
       echo -e -n "\033[00m"
   }
   
   Color_Text()
   {
     echo -e " \e[0;$2m$1\e[0m"
   }
   
   Echo_Red()
   {
     echo $(Color_Text "$1" "31")
   }
   
   Echo_Green()
   {
     echo $(Color_Text "$1" "32")
   }
   
   Echo_Yellow()
   {
     echo $(Color_Text "$1" "33")
   }
   
   : > file.list
   
   for file in $(ls src/*)
   do
     echo $file >> file.list
   done
   
   Echo_Green "file list:\n"
   Echo_Green "========================\n"
   
   cat file.list
   
   Echo_Green "========================\n"
   
   
   Echo_Yellow "Phan run\n"
   Echo_Yellow "========================\n"
   
   ./vendor/bin/phan -f file.list -o res.out
   
   Echo_Yellow "========================\n"
   
   Echo_Red "error log\n"
   Echo_Red "========================\n"
   
   cat res.out
   
   Echo_Red "========================\n"
   #https://mengkang.net/1356.html 
   [root@localhost ast]# sh test.sh
   file list:
   ========================
   src/a.php
   ========================
   Phan run
   ========================
   PHP Warning:  Unsupported declare 'strict_types' in /ast/vendor/phan/phan/src/phan.php on line 1
   PHP Parse error:  syntax error, unexpected T_FUNCTION, expecting T_PAAMAYIM_NEKUDOTAYIM in /ast/vendor/phan/phan/src/phan.php on line 29
   ========================
   error log
   ========================
   cat: res.out: No such file or directory
   ========================

   
   [root@localhost ast]# vi vendor/bin/phan
   #!/usr/bin/env php7
   <?php require_once __DIR__ . '/src/phan.php';
  # 安装
  composer require --dev nunomaduro/larastan
  
  # 分析代码
  php artisan code:analyse
  而 code:analyse 命令有些参数可以帮助你自定义分析过程。
  
  # 默认为 5。0 表示最宽松，7 表示最严格。
  php artisan code:analyse --level=[0-7]
  
  # 分析指定的路径。
  php artisan code:analyse --paths="modules,app,domain" 
   安装的时候如果出现提示 Your requirements could not be resolved to an installable set of packages.
   改用以下的命令安装
   先执行 composer update
   再执行 composer require nunomaduro/larastan --update-with-all-dependencies
```
### phpcs

### phpmd
### 语法检测
```javascript
composer require overtrue/phplint --dev -vvv
$ ./vendor/bin/phplint ./ --exclude=vendor
$ ./vendor/bin/phplint

```
### psysh
### 管理缓存
```javascript
https://learnku.com/articles/26314
$ curl -sO http://gordalina.github.io/cachetool/downloads/cachetool.phar

$ chmod +x cachetool.phar

$ php cachetool.phar opcache:reset --fcgi
```
### php7cc语法检测
```javascript
//https://github.com/sstalle/php7cc/releases
composer global require sstalle/php7cc
export PATH="$PATH:$HOME/.config/composer/vendor/bin"
php7cc /path/to/my/file.php
php7cc /path/to/my/directory/
php7cc --level=error /path/to/my/directory/ > error.txt

```

### spike

### phpcbf
### 加速composer开启多线程安装下载
```javascript
$ composer global require hirak/prestissimo
$ composer global remove hirak/prestissimo
$ composer create-project laravel/laravel laravel1 --no-progress --profile --prefer-dist
```
### 包构建工具package-builder
```javascript
//
安装工具

$ composer global require 'overtrue/package-builder' --prefer-source
创建项目

$ package-builder build [目标目录]
$ package-builder build ./weather
# 然后按提示操作即可
# 包名：xkeyi/weather
# 命名空间：Xkeyi\Weather 
# 描述：A weather SDK
接下来我们需要在 composer.json 中声明包自动加载的命名空间，进入项目目录，执行命令：composer dump-autoload
```
### pecl
```javascript
pecl install swoole 默认是按照最新版的，如果有你的环境php不是最新，那需要按照PHP版本去安装
安装PHP是7.1版本的swoole
pecl -d php_suffix=7.1 install swoole-1.9.23
pecl channel-update pecl.php.net
```
### 经纬度行政区域查询
```javascript

curl "http://116.196.105.215:1234/gis?auth_user=freevip&latitude=39.880655&longitude=116.354386"
{"error":0,"msg":"成功","data":{"country":"CHN","en0":"","en1":"","en2":"","en3":"","zh0":"中国","zh1":"北京市","zh2":"","zh3":"西城区"}}
```
### 格式化 SQL
```javascript
composer global require jdorn/sql-formatter

sql-formatter "SELECT SOME QUERY;" // 直接格式化

// 或

echo "SELECT SOME QUERY;" | sql-formatter // 使用管道，更适合较大量的 SQL 语句

```
### 将 PHP 应用快速打包为 PHAR
```javascript
composer require humbug/box
vendor/bin/box compile 
[root@VM_0_14_centos blog]# vendor/bin/box compile

    ____
   / __ )____  _  __
  / __  / __ \| |/_/
 / /_/ / /_/ />  <
/_____/\____/_/|_|


Box version 3.4.0@4eeb285


 // Loading without a configuration file.


In Assertion.php line 2550:

  File "/usr/share/nginx/html/blog/index.php" was expected to exist.


compile [-c|--config CONFIG] [--debug] [--no-parallel] [--no-restart] [--dev] [--no-config] [--with-docker] [-d|--working-dir WORKING-DIR]


 [ERROR] The configuration file is invalid.
[root@VM_0_14_centos blog]# touch index.php
[root@VM_0_14_centos blog]# vendor/bin/box compile

    ____
   / __ )____  _  __
  / __  / __ \| |/_/
 / /_/ / /_/ />  <
/_____/\____/_/|_|


Box version 3.4.0@4eeb285


 // Loading without a configuration file.

🔨  Building the PHAR "/usr/share/nginx/html/blog/index.phar"

? No compactor to register
? Adding main file: /usr/share/nginx/html/blog/index.php
? Adding requirements checker
? Adding binary files
    > No file found
? Auto-discover files? Yes
? Adding files
    > 4828 file(s)
? Generating new stub
  - Using shebang line: #!/usr/bin/env php
  - Using banner:
    > Generated by Humbug Box 3.4.0@4eeb285.
    >
    > @link https://github.com/humbug/box
? Dumping the Composer autoloader
? Removing the Composer dump artefacts
? No compression
? Setting file permissions to 0755
* Done.

No recommendation found.
No warning found.

 // PHAR: 4865 files (24.51MB)
 // You can inspect the generated PHAR with the "info" command.

 // Memory usage: 83.76MB (peak: 85.63MB), time: 109.71s
```
### phptrace
```javascript
wget https://github.com/Qihoo360/phptrace/archive/v1.0.1-beta.tar.gz
tar -zxvf v1.0.1-beta.tar.gz
cd phptrace-1.0.1-beta/extension
/usr/local/php/bin/phpize
./configure --with-php-config=/usr/local/php/bin/php-config
make
make install-all
See any operating system documentation about shared libraries for
more information, such as the ld(1) and ld.so(8) manual pages.
----------------------------------------------------------------------
Installing shared extensions:     /usr/local/php/lib/php/extensions/no-debug-non-zts-20170718/
Installing PHP Trace binary:      /usr/local/php/bin/
[root@VM_0_14_centos extension]# php --ini
Configuration File (php.ini) Path: /usr/local/php/lib
Loaded Configuration File:         /usr/local/php/lib/php.ini
Scan for additional .ini files in: (none)
Additional .ini files parsed:      (none)
vi /usr/local/php/lib/php.ini
extension = trace.so
 /usr/local/php/bin/phptrace -p 19248
```
### gdb
```javascript
for ($i = 0; $i < 3; $i ++) {
    echo $i . PHP_EOL;
    if ($i == 2) {
        $j = $i + 1;
        var_dump($j);
    }
    sleep(1);
}
gdb php
(gdb)run index.php
...
0
1
2
int(3)
[Inferior 1 (process 577) exited normally]

```
### curl
```javascript
curl -x 123.45.67.89:1080 -o page.html http://www.yahoo.com 使用代理访问
添加 --data 或 -D 后面跟传递的参数，再加网址，即可发送POST请求

curl -D "name=jack&age=22" 127.0.0.1:8899/post
如果要对数据内容做编码处理，可使用 –data-urlencode 参数

curl -D "name=jack jason&age=22" 127.0.0.1:8899/post
curl --e http://www.example.com http://www.example.com
用curl通过dict协议去查字典
curl dict://dict.org/d:computer
ftp下载上传
curl -u name:passwd ftp://ip:port/path/file

curl -T localfile -u name:passwd ftp://upload_site:port/path/
```
[php 中使用 strace、gdb、tcpdump 调试工具](http://www.syyong.com/php/Using-strace-GDB-and-tcpdump-debugging-tools-in-PHP.html)

[PHP 中格式化并高亮 SQL 语句](https://laravel-china.org/articles/22230)

[为什么 (int) 快于 intval?](http://www.syyong.com/php/Why-is-int-faster-than-intval.html)

[将 PHP 应用快速打包为 PHAR](https://laravel-china.org/articles/22370)

[PHP 7的新特性](https://github.com/wuxu92/PHP7-Reference-cn)

[MAC之http命令行工具curl](http://coderlt.coding.me/2016/03/22/mac-command-curl/)

[ PHP实现订单的延时处理](https://segmentfault.com/a/1190000012641373)

[30-seconds-of-php-code](https://github.com/appzcoder/30-seconds-of-php-code)

[composer图标](https://poser.pugx.org/)

[用PHP玩转进程之二 — 多进程PHPServer](https://www.fanhaobai.com/2018/09/process-php-multiprocess-server.html)