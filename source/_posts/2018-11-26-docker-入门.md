---
title: docker 入门
date: 2018-11-26 13:45:16
tags:
- docker
---
### 安装
```javascript
#Ubuntu
curl -sSL https://get.daocloud.io/docker | sh
#CentOS
curl -sSL https://get.daocloud.io/docker | sh
yum install docker
sudo chkconfig docker on
sudo systemctl start docker
[root@VM_0_14_centos dnmp]# docker --version
Docker version 18.06.1-ce, build e68fc7a
```
### 配置国内镜像和docker镜像加速器
```javascript
# vim /etc/yum.repos.d/docker-ce.repo
# sed -i 's@https://download-stage.docker.com/linux/centos/7/@https://mirrors.aliyun.com/docker-ce/linux/centos/7/@g' /etc/yum.repos.d/docker-ce.repo
# sed -i 's@https://download-stage.docker.com/linux/centos/gpg@https://mirrors.aliyun.com/docker-ce/linux/centos/gpg@g' /etc/yum.repos.d/docker-ce.repo
# vim /etc/docker/daemon.json
{
"registry-mirrors": [
"https://registry.docker-cn.com"
]
}
# systemctl daemon-reload
# systemctl restart docker
```

### 常用命令
```javascript
docker images 显示本地已有镜像
docker images $mirror-name 查看单个镜像
docker info 显示docker系统信息
docker commit -m -a 提交更新后的镜像
docker build 通过Dockerfile来构建镜像
docker import 本地导入镜像
docker search 查找仓库中镜像
docker push 将镜像推送到仓库
docker pull 将仓库中镜像下载到本地
docker save -o mysql_5.6.tar mysql:5.6 导出镜像到本地
docker load < mysql_5.6.tar 载入镜像
docker rmi $mirror-name 移除镜像
docker attach 运行中容器的stdin，进行命令执行的动作
docker history 显示镜像的历史
docker ps 查看已启动的容器
docker ps -a 查看全部容器
docker logs $container-name 查看容器日志
docker run $mirror-name:$tag 生成一个基于某一镜像的容器
docker run --name $container-name $mirror-name 
docker start $container-name 启动容器
docker stop $container-name 关闭容器
docker run -it $mirror-name 
docker stop $(docker ps -qa) 停止所有运行中的容器
docker restart $container-name 重启容器
docker rm $(docker ps -qa) 移除处于终止状态的容器
docker logs $container-name容器中日志
docker top $container-name 显示运行容器的进程信息
docker inspect $container-name查看容器详细信息
#镜像的导出和导入
sudo docker save repo:tag > backup.tar
sudo docker load < backup.tar
登录hub.docker
sudo docker login
sudo docker push repo:tag
sudo docker pull repo:tag 
# 获取镜像
docker pull ubuntu:14.04

# 以ubuntu:14.04镜像为基础启动并运行一个容器
docker run -it --rm \
    ubuntu:14.04 \
    bash
-it：这是两个参数，一个是 -i：交互式操作，一个是 -t 终端。我们这里打算进入 bash 执行一些命令并查看返回结果，因此我们需要交互式终端。
--rm：这个参数是说容器退出后随之将其删除。默认情况下，为了排障需求，退出的容器并不会立即删除，除非手动 docker rm。我们这里只是随便执行个命令，看看结果，不需要排障和保留结果，因此使用 --rm 可以避免浪费空间。
ubuntu:14.04：这是指用 ubuntu:14.04 镜像为基础来启动容器。
bash：放在镜像名后的是命令，这里我们希望有个交互式 Shell，因此用的是 bash。

# 列出镜像
docker image ls
docker images

# 镜像占用
docker system df

# 清除悬挂镜像
docker image prune

# 删除镜像
docker image rm
docker rmi
# 启动以守护模式创建的名字为demo-u的容器，并以交互模式进入容器
docker run --name demo-u -t -i -d ubuntu:14.04 bash

# 运行后就可以通过ID或名字进入容器，并输出hello world
docker exec -it demo-u /bin/sh -c "echo hello world"

# 查看运行中的容器
docker container ls
docker ps

# 所有容器
docker container ls -a
docker ps -a

# 查看容器日志
docker container logs demo-u
docker logs demo-u

# 终止容器
docker container stop demo-u
docker stop demo-u

# 启动容器
docker container start demo-u
docker start demo-u

# 重启容器
docker container restart demo-u
docker restart demo-u

# 进入容器，退出后容器也停止
docker attach demo-u

# 导出容器
docker export

# 导入容器
docker import

# 删除容器
docker container rm
docker rm

# 清除停止的容器
docker container prune
# 创建数据卷
docker volume create

# 列出数据卷
docker volume ls

# 删除数据卷
docker volume rm

# 清除没用的数据卷
docker volume prune
# 使用php本地服务器查看php环境，加载主机的 ~/web 目录到容器的 /var/www/web目录
mkdir -p ~/web && cd ~/web && echo "<?php phpinfo();" > index.php
docker run -d \
    --name web \
    -p 8080:8080 \
    --mount type=bind,source=`pwd`,target=/var/www/web \
    php:7.2-fpm \
    /bin/sh -c "cd /var/www/web && php -S 0.0.0.0:8080"

或者

docker run -d \
    --name web \
    -p 8080:8080 \
    -v `pwd`:/var/www/web \
    php:7.2-fpm \
    /bin/sh -c "cd /var/www/web && php -S 0.0.0.0:8080"

打开浏览器 0.0.0.0:8080

# 查看数据卷
docker volume inspect web

#从当前目录下的Dockerfile建立镜像
sudo docker build -t reponame:tag .
docker run -i -t -v /var/www/:/data:ro debian:jessie /bin/sh 将宿主机的/var/www/ 绑定挂载到 /data
[root@VM_0_14_centos dnmp]# docker ps
CONTAINER ID        IMAGE                        COMMAND                  CREATED             STATUS              PORTS
                                            NAMES
dacb5c160318        nginx:latest                 "nginx -g 'daemon of…"   10 days ago         Up 10 days          0.0.0.0:8066->80/tcp
                                            mynginx
ec304dae4fcc        php:7.2-fpm                  "docker-php-entrypoi…"   10 days ago         Up 10 days          0.0.0.0:9008->9000/tcp
                                            myphp
bbfc72601fb6        redis:latest                 "docker-entrypoint.s…"   10 days ago         Up 10 days          0.0.0.0:6378->6379/tcp
                                            myredis
edfa4bc0f5dd        redis:alpine                 "docker-entrypoint.s…"   13 days ago         Up 13 days          6379/tcp
                                            docker-redis
ff3b951b0c4e        mysql:5.7                    "docker-entrypoint.s…"   13 days ago         Up 13 days          33060/tcp, 0.0.0.0:8002->3306/tcp                                  docker-mysql
b6a66b9fbd81        nginx:alpine                 "nginx -g 'daemon of…"   13 days ago         Up 13 days          0.0.0.0:8000->80/tcp
                                            docker-webserver
fa4ac5c4f074        dockerlnmp_php-fpm           "/bin/sh -c /usr/bin…"   13 days ago         Up 13 days          9000/tcp
                                            docker-php-fpm
761e1c0ff67d        nodebb/docker                "/bin/sh -c './nodeb…"   2 weeks ago         Up 2 weeks          0.0.0.0:4567->4567/tcp
                                            forum
c6bcf70a8a4b        mongo                        "docker-entrypoint.s…"   2 weeks ago         Up 2 weeks          27017/tcp
                                            mongo
ed62d86f87de        nginx                        "nginx -g 'daemon of…"   2 weeks ago         Up 2 weeks          0.0.0.0:8088->80/tcp
                                            menginx
90cfe3276eab        ghost:alpine                 "docker-entrypoint.s…"   3 weeks ago         Up 3 weeks          0.0.0.0:2368->2368/tcp
                                            blog
17aee656754d        mobz/elasticsearch-head:5    "/bin/sh -c 'grunt s…"   3 weeks ago         Up 3 weeks          0.0.0.0:9100->9100/tcp
                                            compassionate_allen
68289f905e37        nginx:alpine                 "nginx -g 'daemon of…"   4 weeks ago         Up 2 weeks          0.0.0.0:80->80/tcp, 0.0.0.0:443->443/tcp, 0.0.0.0:8080->8080/tcp   dockerlnmp_nginx_1
2b887554e523        dockerlnmp_php56             "docker-php-entrypoi…"   4 weeks ago         Up 2 weeks          9000/tcp
                                            dockerlnmp_php56_1
68b8d29a95dc        dockerlnmp_php72             "docker-php-entrypoi…"   4 weeks ago         Up 2 weeks          9000/tcp
                                            dockerlnmp_php72_1
7c8634b66fcb        portainer/portainer:latest   "/portainer"             4 weeks ago         Up 4 weeks          0.0.0.0:9000->9000/tcp
                                            dockerlnmp_portainer_1
[root@VM_0_14_centos dnmp]# docker top ec304dae4fcc
UID                 PID                 PPID                C                   STIME               TTY                 TIME
   CMD
root                12888               12865               0                   Nov15               ?                   00:00:26
   php-fpm: master process (/usr/local/etc/php-fpm.conf)
33                  12971               12888               0                   Nov15               ?                   00:00:00
   php-fpm: pool www
33                  12972               12888               0                   Nov15               ?                   00:00:00
   php-fpm: pool www
// 进入redis容器
docker exec -it 51 redis-cli
//安装PHP扩展
docker-compose up -d
docker-compose exec iu_phpfpm docker-php-ext-install pdo_mysql
//重启容器 在启动的容器dnmp_nginx_1中运行
docker-compose restart  iu_phpfpm
docker exec -it dnmp_nginx_1 nginx -s reload
docker cp blabla:/app/file.txt .  # 把docker里面/app目录下的file.txt文件复制出来到现在所在的目录
docker run -it --name blabla  -p <物理机>:<容器>(e.g. 127.0.0.1:3306:3306)  \
-v /your/local/path/:/map/path/in/docker/ -v /etc/localtime:/etc/localtime \
--net =host -d reponame:tag
# 启动容器 
#[-it 是启动交互和伪终端]
#[-p  <IP>:<宿主机端口>:<容器端口>  将宿主机（物理机)映射或者可以理解为绑定,<IP>可以指定，也可以不指定，不指定默认是0.0.0.0,建议还是指定]
#[-v  是挂载本机目录到到docker目录,最好每次都把-v /etc/localtime:/etc/localtime也带上，确保docker 容器内时间和服务器时间一致]
#[-d  是daemonize的意思，就是使容器成为守护进程，后台运作]  
#[--net是设置docker的网络模式，默认不设置的话就是bridge模式，现在设置为和物理机网络绑定的host模式，更多可以看 Docker的4种网络模式(http://www.cnblogs.com/gispathfinder/p/5871043.html)
#[--link 是容器链接]
```
镜像如同类，容器如同类生成的对象。
### Dockerfile
Dockerfile是Docker用来构建镜像的文本文件，包含自定义的指令和格式, 可以通过docker build命令从Dockerfile中构建镜像。

以下Dockerfile文件的NGINX容器映射了80,8080和443端口，工作目录为./www/demo,关联容器php72,php56.
```javascript

 git clone https://github.com/helingfeng/Docker-LNMP.git
 $ cd Docker-LNMP   // 进入项目根目录
 $ docker-compose up -d   // 容器编排命令
 [root@VM_0_14_centos Docker-LNMP]# cat docker-compose.yml
 version: '3'
 
 services:
 
   nginx:
     image: nginx:alpine
     ports:
       - "80:80"
       - "8080:8080"
       - "443:443"
     volumes:
       - ${WORKSPACES}:/var/www/html/:rw,cached
       - ./conf/nginx/conf.d:/etc/nginx/conf.d/:ro,cached
       - ./conf/nginx/nginx.conf:/etc/nginx/nginx.conf:ro,cached
       - ./log/nginx/:/var/log/nginx/:rw,cached
     links:
       - php72:fpm72
       - php56:fpm56
     environment:
       - TZ=Asia/Shanghai
     networks:
       docker_net:
         ipv4_address: ${NGINX_IP}
 
   php72:
     build: ./php/php72/
     expose:
       - "9000"
     volumes:
       - ${WORKSPACES}:/var/www/html/:rw,cached
       - ./conf/php/php72.ini:/usr/local/etc/php/php.ini:ro,cached
       - ./conf/php/php-fpm.d/www72.conf:/usr/local/etc/php-fpm.d/www.conf:rw,cached
       - ./log/php-fpm/:/var/log/php-fpm/:rw,cached
     links:
       - mysql:mysql
       - redis:redis
     networks:
       docker_net:
         ipv4_address: ${PHP72_IP}
 
   php56:
     build: ./php/php56/
     expose:
       - "9000"
     volumes:
       - ${WORKSPACES}:/var/www/html/:rw,cached
       - ./conf/php/php56.ini:/usr/local/etc/php/php.ini:ro,cached
       - ./conf/php/php-fpm.d/www56.conf:/usr/local/etc/php-fpm.d/www.conf:rw,cached
       - ./log/php-fpm/:/var/log/php-fpm/:rw,cached
     links:
       - mysql:mysql
       - redis:redis
     networks:
       docker_net:
         ipv4_address: ${PHP56_IP}
 
   mysql:
     image: mysql:5.6
     ports:
       - "3306:3306"
     volumes:
       - ./conf/mysql/my.cnf:/etc/mysql/my.cnf:ro,cached
       - ./mysql/:/var/lib/mysql/:rw,cached
       - ./log/mysql/:/var/log/mysql/:rw,cached
     environment:
       MYSQL_ROOT_PASSWORD: "123456"
     networks:
       docker_net:
         ipv4_address: ${MYSQL_IP}
 
   redis:
     image: redis:latest
     ports:
       - "6379:6379"
     networks:
       docker_net:
         ipv4_address: ${REDIS_IP}
 
   portainer:
     image: portainer/portainer:latest
     ports:
       - "9000:9000"
     volumes:
       - /var/run/docker.sock:/var/run/docker.sock:cached
       - ./portainer/:/data:cached
     networks:
       docker_net:
         ipv4_address: ${PORTAINER_IP}
 
 networks:
   docker_net:
     driver: bridge
     ipam:
       driver: default
       config:
         -
           subnet: "${DOCKER_SUBNET}"
 
 [root@VM_0_14_centos Docker-LNMP]# cat .env
 # 测试与生产环境，可以根据配置文件进行区分
 
 WORKSPACES=./www/
 
 # 内部网络固定IP
 DOCKER_SUBNET=172.100.0.0/16
 NGINX_IP=172.100.0.2
 PHP56_IP=172.100.0.4
 PHP72_IP=172.100.0.3
 REDIS_IP=172.100.0.6
 MYSQL_IP=172.100.0.5
 PORTAINER_IP=172.100.0.7
 
 [root@VM_0_14_centos Docker-LNMP]# cat conf/nginx/conf.d/google.conf
 server {
     listen       8080;
     server_name  127.0.0.1;
 
     location / {
         proxy_pass http://google.helingfeng.com;
     }
 
 }
  #docker exec -it dockerlnmp_nginx_1 nginx -s reload
  使用–link参数可以让容器之间安全的进行交互
  docker run -d --name db NAME:TAG
  docker run -d -P --name web --link db:db NAME:TAG
  要让外部访问这些应用时，可以通过-P或-p参数来指定端口映射。当使用-P标记时，docker会随机映射一个49000～49900的端口到内部容器开放的网络端口
  docker run -d -P NAME:TAG
  docker exec 在容器内执行命令。
  例如，进入正在运行的 foo 容器，并连接 (attach) 到一个新的 Shell 进程：docker exec -it foo /bin/bash
  docker run -ti --c 512 agileek/cpuset-test  一键创建并同时启动该容器。
  查看镜像详细信息
  docker inspect NAME:TAG
  停用全部运行中的容器:
  docker stop $(docker ps -q)
  删除全部容器
  docker rm $(docker ps -aq)
  一条命令实现停用并删除容器
  docker stop $(docker ps -q) & docker rm $(docker ps -aq)
  删除所有未打 tag 的镜像
  docker rmi $(docker images -q | awk '/^<none>/ { print $3 }')
  删除所有镜像
  docker rmi $(docker images -q)
```
打开 http://118.24.158.116 即可看到phpinfo页面

打开 http://118.24.158.116:8080/ 即可使用谷歌镜像

打开http://118.24.158.116:9000/ 可以看到docker gui 网页管理页面

![d](https://wx1.sinaimg.cn/mw690/c08d7e89ly1fxlqsrur10j21g00jtwhp.jpg)
### 实例
```javascript
1.本地安装git、docker和docker-compose
2.git clone https://github.com/yeszao/dnmp.git
3.如果不是root用户，还需将当前用户加入docker用户组  sudo gpasswd -a ${USER} docker
4.启动
$ cd dnmp
$ cp env.sample .env   # Windows系统请用copy命令，或者用编辑器打开后另存为.env
$ docker-compose up
5.访问
http://localhost： 默认http站点
https://localhost：自定义证书https站点，访问时浏览器会有安全提示，忽略提示访问即可
两个站点使用同一PHP代码：./www/localhost/index.php

5.要修改端口、日志文件位置、以及是否替换source.list文件等，请修改.env文件，然后重新构建：

$ docker-compose build php54    # 重建单个服务
$ docker-compose build          # 重建全部服务
$cat .env

```
### phpstorm 破解
```javascript
http://blog.lanyus.com/archives/317.html https://gitee.com/pengzhile/jetbrains-agent
 https://github.com/ilanyu/ReverseProxy/releases/latest
 ./ReverseProxy_[OS]_[ARCH] -h
 
 Usage of ReverseProxy_[OS]_[ARCH]:
   -l string
         listen on ip:port (default "0.0.0.0:8888")
   -r string
         reverse proxy addr (default "http://idea.lanyus.com:80")
         [root@VM_0_14_centos ~]# docker pull ilanyu/golang-reverseproxy
         Using default tag: latest
         latest: Pulling from ilanyu/golang-reverseproxy
         Digest: sha256:7508af38dc06ab72e35b60d7934a6f043d68c5dc2cb824a705d4e452e22c6524
         Status: Image is up to date for ilanyu/golang-reverseproxy:latest
         [root@VM_0_14_centos ~]# docker run -d -p 8822:8888 ilanyu/golang-reverseproxy
         ec5221606e6935986dbb631e34e96c0282664ec392f5615338e14b39f61aaf3c
http://118.24.158.116:8822/          
```
### 使用 Docker 快速搭建 LNMP 开发环境
```javascript
//https://github.com/Al-Waler/DNMP 在docker-compose.yml 所在目录执行docker-compose up -d
vi docker-compose.yml
version: "2.0"
services:
  mydb:
    container_name: "mydb"
    restart: always
    ports:
      - "3306:3306"
    volumes:      #挂載目录
      - /home/kirito/mysql:/var/lib/mysql
      - /etc/localtime:/etc/localtime:ro #设置容器时期和宿主机同步
    environment:
      MYSQL_ROOT_PASSWORD: 123456
    image: mysql:5.7 #容器引用镜像
  myredis:
    container_name: "myredis"
    restart: always
    ports:
      - "6379:6379"
    volumes:      #挂載目录
      - /home/kirito/redis:/data
      - /etc/localtime:/etc/localtime:ro #设置容器时期和宿主机同步
    image: redis:latest #容器引用镜像
  myphp:
    build: ./php/
    container_name: "myphp"
    restart: always
    ports:
      - "9000:9000"
    volumes:      #挂載目录
      - /home/kirito/www:/var/www
      - /var/run/sock:/tmp/sock
      - /etc/php:/usr/local/etc
      - /etc/localtime:/etc/localtime:ro #设置容器时期和宿主机同步
    links:
      - "mydb"
      - "myredis"
  mynginx:
    container_name: "mynginx"
    restart: always
    ports:
      - "80:80"
    volumes:      #挂載目录
      - /home/kirito/www:/usr/share/nginx/www
      - /etc/nginx:/etc/nginx
      - /home/kirito/logs/nginx.logs:/var/log/nginx
      - /etc/localtime:/etc/localtime:ro #设置容器时期和宿主机同步
      - /var/run/sock:/var/run/sock
    links:
      - "myphp"
    image: nginx:latest #容器引用镜像
```
### docker图
![img](https://iocaffcdn.phphub.org/uploads/images/201811/30/87/g8XUdYlidH.png!/fw/1240)
### 注意
1. 不要把 docker 当做数据容器来使用，数据一定要用 volumes 放在容器外面
2. 不要把 docker-compose 文件暴露给别人， 因为上面有你的服务器信息
3. 多用 docker-compose 的命令去操作， 不要用 docker 手动命令&docker-compose 去同时操作
4. 写一个脚本类的东西，自动备份docker 映射出来的数据。
5. 不要把所有服务都放在一个 docker 容器里面
6. 数据库(mysql,postgresql,redis,mongodb等)最好不要也放到docker容器里面，因为第一，会让查询隔多了一层docker的容器，查询速度变慢(从docker容器里面拿出数据库，查询至少可以快一倍);第二，数据也不是经常需要重新启动的存在，不像web应用那样有点新功能就要重新部署 
### 渗透测试系统实践
```javascript
//https://github.com/78778443/permeate
docker run --name mysqlserver -e MYSQL_ROOT_PASSWORD=123 -d -i -p 3309:3306 mysql:5.6

docker run --name permeate_test --link mysqlserver:db -d -i -p 8881:80 registry.cn-hangzhou.aliyuncs.com/daxia/websafe:laster

如果提示容器名称已存在，可以先把容器删除，命令为 docker rm $(docker ps -aq) -f
docker exec permeate_test zsh -c "php /root/start.php"
docker exec permeate_test zsh -c "nginx && /usr/sbin/php-fpm7.2 -R"
浏览器访问 http://118.24.158.116:8881
我们已经将mysqlserver链接到了permeate容器当中，此时数据库地址直接填写db即可,数据库密码笔者在启动MySQL容器时设置的为123
```
### 代码片段托管
```javascript
https://snibox-demo.herokuapp.com/ https://learnku.com/articles/23922
git clone https://github.com/snibox/snibox-docker
cd snibox-docker
./bin/setup
./bin/start
docker-compose up
sniboxdocker_database_1 is up-to-date
sniboxdocker_backend_1 is up-to-date
Recreating sniboxdocker_frontend_1 ...
Recreating sniboxdocker_frontend_1 ... done
Attaching to sniboxdocker_database_1, sniboxdocker_backend_1, sniboxdocker_frontend_1
database_1  | The files belonging to this database system will be owned by user "postgres".
database_1  | This user must also own the server process.
```
### MongoDB在Docker中的部署
```javascript
$ docker pull mongo
$ docker images mongo
REPOSITORY    TAG      IMAGE ID      CREATED        VIRTUAL SIZE
mongo         latest   50fa1fa47718  11 hours ago   402 MB
$ docker run --name mongo -v /home/docker/mongo:/data/db -p 27017:27017 -d mongo
https://www.fanhaobai.com/2017/01/mongo-docker-install.html
$ docker ps -a
CONTAINER ID   IMAGE   COMMAND          CREATED         STATUS        PORTS                      NAMES
d83cab80f13d   mongo   "/entrypoint.sh  3 seconds ago   Up 2 seconds   0.0.0.0:27017->27017/tcp   mongo
$ docker exec -it mongo /bin/bash
$ mongo
$ use admin
$ db.createUser({user:"admin",pwd:"admin",roles: [{role: "root",db: "admin"}]})
$ db.auth('admin','admin')

$ cp /entrypoint.sh /data/db
$ vim /home/docker/mongo/entrypoint.sh
if [[ "$1" == mongo* ]] && [ "$(id -u)" = '0' ]; then
    if [ "$1" = 'mongod' ]; then
	chown -R mongodb /data/configdb /data/db
    fi
    set -- "$@" "--auth"                                       #开启auth认证
    exec gosu mongodb "$BASH_SOURCE" "$@"
fi
$ cp -f /data/db/entrypoint.sh /
$ exit
docker restart mongo
$ docker diff mongo                              #查看容器所修改内容
$ docker commit -a "fanhaobai" -m "add auth" mongo mongo:latest
$ docker images mongo

```
### yml语法
```javascript
语法规则https://blog.yiranzai.cn/posts/26848/

可以写注释。#表示注释（这一点无比重要，小声说一句垃圾 json ）
大小写敏感
使用缩进表示层级关系
缩进时不允许使用Tab键，只允许使用空格。
缩进的空格数目不重要，只要同一个层级的元素左侧对齐即可
Compose 恰好满足了这样的需求。它允许用户通过一个单独的 docker-compose.yml 模板文件（YAML 格式）来定义一组相关联的应用容器为一个项目（project）。

Compose 中有两个重要的概念：

服务 (service)：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。
项目 (project)：由一组关联的应用容器组成的一个完整业务单元，在 docker-compose.yml 文件中定义。
Compose 模板文件 是使用 Compose 的核心，格式为 YAML 格式
docker-compose.yml 可以读取同目录下的 .env 中的配置
模板文件中的变量配置到 .env 中

# nginx http port
NGINX_HTTP_PORT=80
# nginx https port
NGINX_HTTPS_PORT=443
# mysql port
MYSQL_PORT=3306
# database path
DATA_PATH=./mysql/data/
# mysql root password
MYSQL_ROOT_PWD=root
# web root path
WEB_ROOT=/webroot
# time zone
TZ=Asia/Shanghai
```
### 构建一个Docker镜像
```javascript
https://blog.yiranzai.cn/posts/26843/
vi Dockerfile
FROM node:lts-slim

RUN npm install hexo-cli -g

CMD [ "hexo", "-v" ]]

docker build -t username/image-name .
docker run --rm username/image-name
[root@su ~]# docker run --rm su/su-docker
hexo-cli: 1.1.0
os: Linux 3.10.0-514.26.2.el7.x86_64 linux x64
http_parser: 2.8.0
node: 10.15.3
v8: 6.8.275.32-node.51
uv: 1.23.2
zlib: 1.2.11
ares: 1.15.0
modules: 64
nghttp2: 1.34.0
napi: 3
openssl: 1.1.0j
icu: 62.1
unicode: 11.0
cldr: 33.1
tz: 2018e
docker login
docker push username/image-name:tag

```
### nginx 容器模拟负载均衡
```javascript
vim /etc/docker/daemon.json 没有则新建此文件 https://learnku.com/articles/24679

{
    "registry-mirrors": [
        "https://registry.docker-cn.com"
    ]
}

获取nginx镜像 docker pull nginx
然后使用 docker images可以查看获取的镜像
在本地创建docker/nginx1/index.html文件和docker/nginx2/index.html文件，用于挂载项目文件
在index.html文件输入内容 "hello,this is nginx1." 和 "hello,this is nginx2".
创建运行nginx容器
1.模拟转发请求的nginx
docker run  -d --name nginx -p 8081:80 nginx
2.模拟第一台服务器的nginx
docker run  -d --name nginx1 -p 8082:80 -v /root/docker/nginx1:/usr/share/nginx/html nginx
3.模拟第二台服务器的nginx
docker run  -d --name nginx2 -p 8083:80 -v /root/docker/nginx2:/usr/share/nginx/html nginx
-d：守护进程，在后台运行
-v：挂载文件，挂载刚刚创建的docker/nginx1目录
-p：表示本地映射容器内的端口 (本地8081映射容器内的80)
--name ：取名称

在浏览器输入127.0.0.1:8081、127.0.0.1:8082、127.0.0.1:8083可以访问容器内的index.html

进入容器nginx，安装vim
docker exec -it nginx /bin/bash
sudo apt-get update
sudo apt-gei install vim

vim /etc/nginx/nginx.conf 文件，注意这里的ip是宿主机的ip
upstream webapp { 
  server 192.168.1.187:8082; 
  server 192.168.1.187:8083; 
}
vim /etc/nginx/conf.d/default.conf文件，在location / {}引入刚刚写的webapp.

proxy_pass http://webapp;
service nginx restart
测试
#sh -c "while true;do curl 127.0.0.1:8080;done;"
```
###  lnmp 环境搭建系列
```javascript
//拉去镜像https://learnku.com/articles/25939
docker pull mysql:5.7

/*相关参数解析*/
//-d 开启Daemon模式。
//-p hostPort:containerPort  端口映射
//-e 为容器设置环境变量  MYSQL_ROOT_PASSWORD：mysql密码
//--name 容器启动时的名字
docker run -d -p 3307:3306 -e MYSQL_ROOT_PASSWORD=mypassword --name mysql mysql:5.7

docker run --name nginx -p 81:80 -d nginx

cd /var/www/nginx/conf
//复制nginx配置文件
docker cp nginx:/etc/nginx/conf.d/default.conf default.conf

docker ps -a                       # 查看正在运行的容器

docker stop nginx                  # 停止正在运行的容器

docker start nginx                 # 启动一个已经停止的容器

docker rm nginx                    # 删除容器
启动nginx，并且将nginx配置文件、网站根目录映射到宿主机上

//如果挂载一个空的数据卷到容器中的一个非空目录中，那么这个目录下的文件会被复制到数据卷中。

//如果挂载一个非空的数据卷到容器中的一个目录中，那么容器中的目录中会显示数据卷中的数据。如果原来容器中的目录中有数据，那么这些原始数据会被隐藏掉。    

docker run --name nginx -p 81:80 -v /var/www/nginx/html:/usr/share/nginx/html -v /var/www/nginx/default.conf:/etc/nginx/conf.d/default.conf
docker pull php:7.2-fpm
复制php.ini 需要进入容器中解压php.tar.xz。如果本地有php.ini文件可将本地文件复制，忽略此步骤

//启动php容器
docker run --name php-fpm -p 9001:9000 -itd 7.2:fpm 
//进入php容器
docker exec -it php-fpm /bin/bash
//进入 /usr/local 目录解压 php.tar.xz
cd /usr/local
tar -xvf php.tar.xz

//复制文件
cp php-fpm:/usr/local/php-7.2.15/php.ini-development php.ini
cp php-fpm:/usr/local/etc/php-fpm.d/www.conf  www.conf
docker stop php-fpm
docker rm php-fpm
重新启动php，并将配置文件映射的容器中
docker run --name php-fpm -p 9001:9000  --link mysql:mysql -v /var/www/nginx/html:/var/www/html -v /var/www/nginx/conf/www.conf:/usr/local/etc/php-fpm.d/www.conf -v /var/www/nginx/conf/php.ini:/usr/local/etc/php/php.ini -d php:fpm       

修改nginx配置文件

server {

    listen       80;

    server_name  _;

    root /usr/share/nginx/html;

    index index.php index.html index.htm;

    //charset koi8-r;

    //access_log  /var/log/nginx/log/host.access.log  main;

    location / {

        //root   /usr/share/nginx/html;

        //index  index.php index.html index.htm;

    try_files $uri $uri/ =404;

    }

    error_page  404  /404.html;

    location = /40x.html {

        root    /user/share/nginx/html;     

    }

    // redirect server error pages to the static page /50x.html

    //

    error_page   500 502 503 504  /50x.html;

    location = /50x.html {

        root   /usr/share/nginx/html;

    }

    // proxy the PHP scripts to Apache listening on 127.0.0.1:80

    //

    //location ~ \.php$ {

    //    proxy_pass   http://127.0.0.1;

    //}

    // pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000

    //

    location ~ \.php$ {

        fastcgi_pass   php-fpm:9000;

        fastcgi_index  index.php;

//        fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;

    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;

        include        fastcgi_params;

    }

    // deny access to .htaccess files, if Apache's document root

    // concurs with nginx's one

    //

    location ~ /\.ht {

        deny  all;

    }

}
重新启动 nginx 让其支持 php

docker run --name nginx -p 81:80 --link php-fpm -v /var/www/nginx/html:/usr/share/nginx/html -v /var/www/nginx/conf/default.conf:/etc/nginx/conf.d/default.conf -d nginx    
在 /var/www/nginx/html 新建index.php

<?php
    phpinfo();
```
### docker 建立私有仓库
```javascript
docker pull registry
docker run -p 5000:5000 -v /data/registry:/var/lib/registry --name registry -d registry

https://www.njphper.com/posts/e9b4ffd3.html
```
### docker/laradock 
```javascript
git clone https://github.com/Laradock/laradock.git
cd laradock
cp env-example .env

DB_HOST=mysql
REDIS_HOST=redis
QUEUE_HOST=beanstalkd

docker-compose up -d nginx mysql phpmyadmin redis workspace 

docker run --name  myphp-fpm -v ~/nginx/www:/www  -d php:7.1-fpm


    location ~ \.php$ {
        fastcgi_pass   php:9000;
        fastcgi_index  index.php;
        fastcgi_param  SCRIPT_FILENAME  /www/$fastcgi_script_name;
        include        fastcgi_params;
    }
php:9000: 表示 php-fpm 服务的 URL，下面我们会具体说明。
/www/: 是 myphp-fpm 中 php 文件的存储路径，映射到本地的～/nginx/www 目录。
docker run --name runoob-php-nginx -p 8083:80  -d \
-v ~/nginx/www:/usr/share/nginx/html:ro \
-v ~/nginx/conf/conf.d:/etc/nginx/conf.d:ro \ 
--link myphp-fpm:php \
    nginx
-p 8083:80: 端口映射，把 nginx** 中的 80 映射到本地的 8083 端口。
~/nginx/www**: 是本地 html 文件的存储目录，/usr/share/nginx/html 是容器内 html 文件的存储目录。
~/nginx/conf/conf.d**: 是本地 nginx 配置文件的存储目录，/etc/nginx/conf.d 是容器内 nginx 配置文件的存储目录。
--link myphp-fpm:php: 把 myphp-fpm 的网络并入 nginx，并通过修改 nginx 的 /etc/hosts，把域名 php 映射成 127.0.0.1，让 nginx 通过 php:9000 访问 php-fpm。
接下来我们在～/nginx/www 目录下创建 index.php  https://learnku.com/articles/30878
```
### Docker LNMP 部署 PHP 运行环境
```javascript
$ git clone https://github.com/yanlongma/docker-lnmp.git
进入 docker-lnmp 目录，生成配置文件 .env

$ cd docker-lnmp
$ cp env-template .env
如需映射到其它目录，配置 .env 文件中 WEB_ROOT_PATH 即可。

启动服务

在 docker-lnmp 目录，启动服务，命令如下：

$ docker-compose up -d nginx
Creating network "docker-lnmp_default" with the default driver
Creating docker-lnmp_mysql_1   ... done
Creating docker-lnmp_php-fpm_1 ... done
Creating docker-lnmp_nginx_1   ... done
nginx 默认会启动 php-fpm 和 mysql 服务，如需启动其它服务请手动添加，可选服务有 mongo、redis、memcached。

启动成功后，在 docker-lnmp 同级目录新建 phpinfo.php 文件，浏览器访问 http://localhost/phpinfo.php，则可看到 phpinfo() 相关信息。

关闭服务

在 docker-lnmp 目录，关闭服务，命令如下：

$ docker-compose down
构建服务

如修改 dockerfile 文件，需重新构建服务，如重新构建 php-fpm 命令如下：

$ docker-compose build php-fpm
建议先关闭服务，构建完成再重启服务。

虚拟主机

配置虚拟主机请参考 nignx/sites/yii.conf 文件，配置完需构建并重启服务。
```
[elasticsearch中文发行版](https://github.com/medcl/elasticsearch-rtf)

[Docker 安装与使用 ](https://learnku.com/articles/29690)

[docker常用基础 ](https://www.guaosi.com/2018/11/30/docker-basic/)

[了解yaml和Docker-compose](https://blog.yiranzai.cn/posts/26848/)

[用 Docker 搭建 Laravel 开发环境](https://learnku.com/articles/24862#topnav)

[使 docker部署laravel项目](https://laravel-china.org/topics/3319/deploy-your-laravel-project-using-docker)

[Docker 命令大全](http://www.runoob.com/docker/docker-command-manual.html)

[Docker 快速上手指南](https://segmentfault.com/a/1190000008822648)

[Docker集成多项目LNMP环境](https://github.com/lukedever/docker-lnmp)

[小白折腾服务器，docker-compose + deployer](https://github.com/aen233/deploy-iu)

[PHP 一键 Docker LNMP 环境](https://laravel-china.org/articles/19289)

[Docker 实践（八）：构建 Laravel 开发环境](https://segmentfault.com/a/1190000007873815)

[查询字符串工具ripgrep](https://github.com/BurntSushi/ripgrep/)

[Dockerfile 与 Compose 环境搭建学习笔记（二）](https://segmentfault.com/a/1190000015579033#articleHeader0)

[图床](https://github.com/aimerforreimu/AUXPI)

[laravel Dockerfile](https://github.com/fanly/laraveldocker)

[使用 Docker 快速搭建 LNMP 开发环境](https://github.com/Chester-Hee/Docker-LNMP)

[自建 Laravel 的 Docker 开发环境](https://laravel-china.org/articles/14767/self-built-laravel-docker-development-environment)

[配置docker使用国内镜像源及镜像加速器](https://www.lucissfer.com/2018/04/26/%E9%85%8D%E7%BD%AEdocker%E4%BD%BF%E7%94%A8%E5%9B%BD%E5%86%85%E9%95%9C%E5%83%8F%E6%BA%90%E5%8F%8A%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F%E5%99%A8/)

[Docker+Git效率工作](https://blog.csdn.net/qq_29245097/article/details/52996911)

[docker灵活的搭建php环境](https://laravel-china.org/articles/19504?#reply73093)

[Docker 快速上手指南]( https://segmentfault.com/a/1190000008822648)

[Docker部署Sentry监控Django应用并使用email+钉钉通知](https://blog.ansheng.me/article/docker-sentry-django-email-dingtalk/ )

[Docker 搭建PHP5.3 5.6 7.2 版本](http://www.hihubs.com/article/355/Docker%20%E6%90%AD%E5%BB%BAPHP5.3%205.6%207.2%20%E7%89%88%E6%9C%AC )  

[WSL+Docker](https://learnku.com/articles/28817)

[生产环境用 Docker](http://h5ip.cn/8XPO )

[一键使用 Docker 集成多项目 LNMP 环境]( https://github.com/lukedever/docker-lnmp ) 

https://laravel-china.org/articles/19367?#reply70893 

[自建 Laravel 的 Docker 开发环境](https://segmentfault.com/a/1190000015722898  )

https://github.com/fanly/laraveldocker

https://github.com/Trumeet/AOSP-Build-Environment-Docker

[最为详细的Docker入门吐血总结](https://www.imooc.com/article/255015)

[Docker 快速入门指引](https://laravel-china.org/articles/2250/docker-quick-start-guide)

[Docker构建程序员的日常](https://segmentfault.com/a/1190000016436478 )

[记录一次被docker多容器通信虐的死去活来的部署之路](https://segmentfault.com/a/1190000016896628) 

[Docker 运行时的用户与组管理](https://segmentfault.com/a/1190000016781704) 

[docker指令学习记录](https://segmentfault.com/a/1190000016730744)

[使用 Docker 快速搭建 LNMP 开发环境](https://github.com/Chester-Hee/Docker-LNMP)  
 
 https://laravel-china.org/topics/12611/docker-quickly-build-lnmp-development-environment
 
[Docker 快速搭建 Lnmp 开发环境](https://laravel-china.org/topics/12611/docker-quickly-build-lnmp-development-environment) 

https://github.com/lijy91/phoenix-backend

[Docker 容器里配置计划任务 crontab]( https://laravel-china.org/topics/2199/docker-container-configuration-plan-task-crontab-daocloud-docker-laravel-5)

[Docker 问答录](https://laravel-china.org/topics/17343) 

[docker 搭建 Laravel 开发环境](https://github.com/ChenJavascript/docker)

[Docker 常用命令](https://laravel-china.org/articles/4542/docker-commands)

[Docker 搭建一个 Sentry](https://laravel-china.org/articles/4300/sentry-build-a-docker)

[Docker 的安装与常用指令](https://laravel-china.org/articles/4541/docker-installation-and-commonly-used-instructions) 

[Docker 快速入门指引](https://laravel-china.org/articles/2250/docker-quick-start-guide)

[Docker 问答录（100 问）](https://blog.lab99.org/post/docker-2016-07-14-faq.html)

[PHP 开发者的 Docker 之旅](https://laravel-china.org/topics/1097/php-developers-docker-tour)

[docker 简单搭建laravel开发环境](https://github.com/ChenJavascript/docker)

[自建 Laravel 的 Docker 开发环境](https://laravel-china.org/articles/14767/self-built-laravel-docker-development-environment)

[Docker for LNMP](https://laravel-china.org/topics/4164/docker-for-lnmpcentos7-nginx-mariadb-php7)

[使用 Docker 完成 MySQL 数据库主从配置](https://laravel-china.org/articles/6631/using-docker-to-complete-master-slave-configuration-of-mysql-database) 

 https://phpdocker.io/generator
 
[docker 容器搭建 lnmp 环境小记](https://laravel-china.org/topics/13497/docker-container-set-up-lnmp-environment)

[docker部署laravel项目](https://laravel-china.org/topics/3319/deploy-your-laravel-project-using-docker)

[Docker 搭建 Laravel 本地环境](https://laravel-china.org/articles/6360/using-docker-to-build-laravel-local-environment)

[新手也能用docker搭建PHP环境](https://github.com/voocel/docker-lnmp)  

[docker-lnmp 快速搭建 PHP 环境](https://laravel-china.org/topics/729/using-docker-to-create-laravel-development-environment)

https://laravel-china.org/topics/6440/using-docker-lnmp-to-build-php-environment-quickly

[yum 快速搭建 lnmp 开发环境](https://laravel-china.org/articles/10735/yum-quickly-build-lnmp-development-environment) 

[Docker 快速搭建 Lnmp 开发环境](https://laravel-china.org/topics/12611/docker-quickly-build-lnmp-development-environment)

[Docker 搭建 PHP 开发环境](https://laravel-china.org/articles/2767/use-docker-to-build-php-development-environment)

[Docker 完成 MySQL 数据库主从配置](https://laravel-china.org/articles/6631/using-docker-to-complete-master-slave-configuration-of-mysql-database)

[docker 搭建自己的开发环境](https://laravel-china.org/articles/10170/the-first-docker-to-build-their-own-development-environment)

[Docker 入门教程](http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html)

[Docker 快速搭建 Lnmp 开发环境](https://laravel-china.org/topics/12611/docker-quickly-build-lnmp-development-environment)

[Docker搭建 Jumpserver 堡垒机操作实践](https://laravel-china.org/articles/19049) 

[Drone是一个基于Docker的持续交付平台，用Go编写](https://github.com/drone/drone) 

[Mac和Windows上的Docker容器管理](https://github.com/docker/kitematic) 

[用于探索 Docker 镜像中每个图层的工具](https://github.com/wagoodman/dive) 

[Docker 和 Nginx 打造高性能的二维码服务]( https://juejin.im/post/5bc9d9316fb9a05d2e1bd2f9)

[Docker 下安装配置 lnmp 环境](https://laravel-china.org/articles/21950)

[容器的工作原理和隔离机制](https://laravel-china.org/articles/18614)

[小白折腾服务器（三）：docker-compose+Dockerfile](https://laravel-china.org/articles/20442)

[《Docker 技术入门与实战》 ](https://github.com/yeasy/docker_practice)

[Docker 使用总结](http://yansu.org/2017/02/21/docker-summary.html)

[docker 搭建 lnmp+ 使用 deployer 部署](https://laravel-china.org/articles/19868)

[用 Docker 构建自己的 PHP 开发环境](https://www.goozp.com/article/77.html)

[把Docker的概念讲的最清楚的一篇文章](https://juejin.im/post/5b260ec26fb9a00e8e4b031a)

[Elasticsearch入门教程之安装与基本使用](https://www.cnblogs.com/luke44/p/elasticsearch-doc.html)

[简明 docker 教程](https://laravel-china.org/articles/22611)

[实用 Docker 速查大全](https://learnku.com/articles/22822)

[通过 Laradock 学 Docker —— 配置篇](https://mp.weixin.qq.com/s/Xmk-Zao-h3RWa6gQ8AiI7w)

[Docker Cheat Sheet](https://github.com/wi1dcard/docker-cheat-sheet)

[docker 搭建 lnmp 环境](https://learnku.com/articles/22627)

[Docker FAQ](https://learnku.com/articles/24531#topnav)

[五分钟快速了解Docker](https://blog.fastrun.cn/2018/01/27/1-14/)

[ Docker 的 MySQL 主从复制搭建](https://learnku.com/articles/30439)

[使用容器 Docker 创建开发环境](https://michael728.github.io/2019/06/02/docker-create-develop-environment/)

[Docker 入门指南](https://michael728.github.io/2019/06/02/docker-useful-often-commands/)