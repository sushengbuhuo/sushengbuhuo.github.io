---
title: gitlab 使用
date: 2019-01-22 11:58:42
tags:
- gitlab
---
### 安装ssh
```javascript
yum install -y curl policycoreutils-pythonopenssh-server

```
### 安装postfix
```javascript
yum install postfix
将postfix服务设置成开机自启动。

安装命令：sudo systemctl enable postfix

 启动postfix。

安装命令：sudo systemctl start postfix
如出现了错误：
job for postfix.service failed. See 'systemctl status postfix.service' and 'journalctl -xn' for deta。

然后执行vi /etc/hosts，注释掉下面这一行

#::1  localhost localhost.localdomain localhost6 localhost6.localdomain6
systemctl start postfix
```
### 添加GitLab镜像
```javascript
wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/gitlab-ce-10.0.0-ce.0.el7.x86_64.rpm
rpm -i gitlab-ce-10.0.0-ce.0.el7.x86_64.rpm
#rpm -e gitlab-ce-10.0.0-ce.0.el7.x86_64 卸载
出现错误：依赖检测失败。
yum install policycoreutils-python
```
### 修改gitlab配置
```javascript
vim  /etc/gitlab/gitlab.rb

修改external_url 'http://xxxx'（xxx：代表公网IP地址）

```
### 启动GitLab
```javascript
gitlab-ctl reconfigure
gitlab-ctl restart
ok: run: alertmanager: (pid 3845) 0s
ok: run: gitaly: (pid 3854) 0s
ok: run: gitlab-monitor: (pid 3866) 0s
ok: run: gitlab-workhorse: (pid 3873) 1s
ok: run: logrotate: (pid 3878) 0s
ok: run: nginx: (pid 3889) 0s
ok: run: node-exporter: (pid 3891) 0s
ok: run: postgres-exporter: (pid 3903) 0s
ok: run: postgresql: (pid 3976) 1s
ok: run: prometheus: (pid 4000) 0s
ok: run: redis: (pid 4008) 0s
ok: run: redis-exporter: (pid 4013) 0s
ok: run: sidekiq: (pid 4025) 0s
ok: run: unicorn: (pid 4033) 1s
直接输入服务器ip和指定端口进行访问
初始账户:root 密码:第一次登录修改密码

```


### 问题
```javascript
排查问题利器：
gitlab-rake gitlab:check ( check查看整体状态值)
gitlab-ctl status  (查询gitlab状态)
 
如果缺少资源，可以使用以下命令关闭Unicorn和Sidekiq，暂时释放一些内存：
sudo gitlab-ctl stop unicorn
sudo gitlab-ctl stop sidekiq
8080端口冲突
原因：由于unicorn默认使用的是8080端口。
解决办法：打开/etc/gitlab/gitlab.rb,打开# unicorn['port'] = 8080 的注释，将8080修改为9090，保存后运行sudo gitlab-ctl reconfigure即可。
```
[5分钟教你搭建一个GitLab仓库](https://mp.weixin.qq.com/s/iLENqV4mULSpeX0JRdgOWQ)

[用GitLab搭建自己的私有GitHub](http://www.54php.cn/default/96.html)

[搭建GitLab](https://www.cnblogs.com/qiuzhimutou/p/9769940.html)

[搭建本地GitLab仓库](https://www.fanhaobai.com/2017/02/gitlab-install.html)

[Git & Gitlab 使用指南](https://www.restran.net/2016/02/23/git-and-gitlab-guide/)