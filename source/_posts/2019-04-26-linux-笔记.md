---
title: linux 笔记
date: 2019-04-26 16:54:15
tags:
- linux
---
### 磁盘空间不足
```javascript
df命令查看当前计算器磁盘空闲情况
 df -a
 从根目录下开始使用du命令查找出空间占用最大的文件
  du -sh /*命令一路追查
 [root@test-os testuser]# df -h   ###物理磁盘空间 查看所有block使用情况
 Filesystem      Size  Used Avail Use% Mounted on
 /dev/sda3       8.8G  8.8G     0 100% /
 tmpfs           931M     0  931M   0% /dev/shm
 /dev/sda1       190M   40M  141M  22% /boot
 [root@test-os testuser]# du -sh /usr/* |grep G  ###查找大文件
 7.3G    /usr/local
 [root@test-os testuser]# du -sh /usr/local/* |grep G
 7.3G    /usr/local/bin
 [root@test-os testuser]# du -sh /usr/local/bin/* |grep G
 7.3G    /usr/local/bin/1g
 
 [root@test-os testuser]# rm -f /usr/local/bin/1g  ###删除大文件
有些文件删除时还被其它进程占用，此时文件并未真正删除，只是标记为 deleted，只有进程结束后才会将文件真正从磁盘中清除。
 [root@test-os ~]# lsof |grep deleted 
 rsyslogd   1250      root    1w      REG                8,3 4888889358     140789 /var/log/messages (deleted)
 
 [root@test-os ~]# #lsof 显示出系统中被打开的文件 
 [root@test-os ~]# #第一列 软件/服务的名称
 [root@test-os ~]# #第八列 文件的大小 
 [root@test-os ~]# #第10列 文件的名字
 [root@test-os ~]# #第11列 标记（硬链接数为0 进程调用数不为零 就会有 delete)
 
 ####重启对应的服务 释放磁盘空间 
 [root@test-os ~]# /etc/init.d/rsyslog restart 
 --------------------- 
 [root@test-os ~]# df -h
 Filesystem      Size  Used Avail Use% Mounted on
 /dev/sda3       8.8G  1.5G  6.9G  18% /
 tmpfs           931M     0  931M   0% /dev/shm
 /dev/sda1       190M   40M  141M  22% /boot
 /tmp/1m        1003K   19K  933K   2% /app/logs
 --------------------- 
 # df -ih 节点磁盘空间
 Filesystem Inodes IUsed IFree IUse% Mounted on
 /dev/vda1 1.9M 299K 1.6M 17% /
 udev  123K 299 123K 1% /dev
 tmpfs  126K 249 125K 1% /run
 tmpfs  126K 4 126K 1% /run/lock
 tmpfs  126K 2 126K 1% /run/shm
 可以看到，inode 区域只被占用了一小部分，还有大量的空间未使用，所以也不是 inode 区域被占满的问题。
 查看哪个目录占用过大：
 
 cd /;du  -sh ./* |sort -nr|more
 发现 /var/spool/postfix/maildrop 这个目录占用了12G 多的空间
 删除这个目录下的内容(通过管道的方式删除,避免参数过长导致无法执行)：
 
 ls | xargs rm -f
 lsof test.log
 这命令只能在文件被写入的时候才能显示内容，最后虽然得到了个进程号，但是因为写完进程就关闭了，所以还是查不到
 
    for i in /home/*; do echo $i; find $i |wc -l; done
 
    通过该命令可以查看每个用户home下inode的占用情况。如果某个目录下的inode很大，那就是问题所在了。
 
```
### git push 报错 fatal: HttpRequestException encountered.
```javascript
Github 禁用了TLS v1.0 and v1.1，必须更新Windows的git凭证管理器

https://github.com/Microsoft/Git-Credential-Manager-for-Windows/releases/tag/v1.18.2

下载并安装后即可解决
 
```
### pip install 失败
```javascript

 pip install myqr
Collecting myqr
  Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by 'ProxyError('Cannot connect to proxy.', NewConnectionError('<pip._vendor.urllib3.connection.VerifiedHTTPSConnection object at 0x03B22330>: Failed to establish a new connection: [WinError 10061] 由于目
标计算机积极拒绝，无法连接。'))': /simple/myqr/
打开Internet选项，选择连接–局域网设置  全部取消勾选，问题解决
https://blog.csdn.net/u010784236/article/details/51820284
```
### awk
```javascript
$ echo 'this is a test' | awk '{print $0}'
$ awk -F ':' '{ print $1 }' demo.txt
$(NF-1) 代表倒数第二个字段。
 
$ awk -F ':' '{print $1, $(NF-1)}' demo.txt
 NR 表示当前处理的是第几行。
 
$ awk -F ':' '{print NR ") " $1}' demo.txt
awk -F ':' '{ print toupper($1) }' demo.txt
awk -F ':' '/usr/ {print $1}' demo.txt #awk ‘条件 动作’ 文件名  print 命令前面是一个正则表达式，只输出包含 usr 的行
awk -F ':' 'NR % 2 == 1 {print $1}' demo.txt 输出奇数行
awk -F ':' '{if ($1 > "m") print $1}' demo.txt
$ awk -F ':' '{if ($1 > "m") print $1; else print "---"}' demo.txt
```
### 批量删除 .DS_Store 文件
`find /home/path -name ".DS_Store" -type f -delete`

### 查看硬盘及内存空间
```javascript
 
# 查看内存及swap大小
free -m
# 查看当前文件夹下所有文件大小（包括子文件夹）
du -sh
# 查看指定文件夹下所有文件大小
du -h /tmp
# 查看tmp目录(包含子目录)的大小
du -ah /tmp

# 查看指定文件夹大小
du -hs ftp
# 查看磁盘剩余空间
df -hl
# 查看每个根路径的分区大小
df -h
# 返回该目录的大小
du -sh [目录名]
# 返回该文件夹总M数
du -sm [文件夹]
```
### 统计文件或目录的个数
```javascript
# 统计文件夹下文件的个数
ls -l | grep '^-' | wc -l
# 统计文件夹下目录的个数
ls -l | grep '^d' | wc -l
# 统计文件夹下文件的个数(包括子文件夹里的)
ls -lR | grep '^-' | wc -l
# 统计文件夹下目录的个数(包括子文件夹里的)
ls -lR | grep '^d' | wc -l
# 统计/var/www目录下的所有py文件
ls -l /var/www | grep py | wc -l
# 统计/var/www目录下(包括子文件夹里的)的所有py文件
ls -lR /var/www | grep py | wc -l
```
### 查看CPU和内存占用
```javascript
# CPU占用最多的前10个进程： 
ps auxw|head -1;ps auxw|sort -rn -k3|head -10 
# 内存消耗最多的前10个进程 
ps auxw|head -1;ps auxw|sort -rn -k4|head -10 
# 虚拟内存使用最多的前10个进程 
ps auxw|head -1;ps auxw|sort -rn -k5|head -10
 按内存占用对进程排序
ps auxw --sort=rss
# 按CPU占用对进程排序
ps auxw --sort=%cpu

查看所有运行的进程
ps -A
```
### curl
```javascript
强制指定本地端口
curl --local-port 51 http://web.example.com

# 查看连接的详细信息
# --trace-time 跟踪/详细输出时，添加时间戳
curl -Sv --trace-time http://web.example.com

```
### 连接你服务器 top10 用户端的 IP 地址
```javascript
netstat -nat | awk '{print $5}' | awk -F ':' '{print $1}' | sort | uniq -c | sort -rn | head -n 10


```
### 最常用的10个命令
```javascript
cat .bash_history | sort | uniq -c | sort -rn | head -n 10 (or cat .zhistory | sort | uniq -c | sort -rn | head -n 10


```
### alias
```javascript
alias nis="npm install --save "
alias svim='sudo vim'
alias mkcd='foo(){ mkdir -p "$1"; cd "$1" }; foo '
alias install='sudo apt get install'
alias update='sudo apt-get update; sudo apt-get upgrade'
alias ..="cd .."
alias ...="cd ..; cd .."
alias www='python -m SimpleHTTPServer 8000'
alias sock5='ssh -D 8080 -q -C -N -f user@your.server'
```
### wget
```javascript
wget http://www.openss7.org/repos/tarballs/strx25-0.9.2.1.ta
$ wget -b http://www.openss7.org/repos/tarballs/strx25-0.9.2.1.tar.bz2
Continuing in background, pid 1984.
Output will be written to `wget-log'.
wget -i download-file-list.txt


```
### 防火墙
```javascript
sudo firewall-cmd --zone=public --add-port=60001/udp --permanent
sudo firewall-cmd --reload
#之后检查新的防火墙规则
firewall-cmd --list-all

//临时关闭防火墙,重启后会重新自动打开
systemctl restart firewalld
//检查防火墙状态
firewall-cmd --state
firewall-cmd --list-all
//Disable firewall
systemctl disable firewalld
systemctl stop firewalld
systemctl status firewalld
//Enable firewall
systemctl enable firewalld
systemctl start firewalld
systemctl status firewalld
```
### 显示 Path 环境变量
```javascript
 $ echo $PATH | tr : \\n
/data2/node-v6.11.0-linux-x64//bin
/usr/bin
/bin
/usr/sbin
/sbin
/usr/local/bin
/usr/local/sbin
/data0/opt/python27/bin

```
### 判断字符串包含
```javascript
if [[ $tar =~ tar.gz ]];then echo "包含";fi
```
### 快速修改后缀名字
```javascript
ll
CentOS-base.repo.repo.bak
epel.repo.repo.bak

ls *.bak|awk -F. '{print $1}'|xargs -t -i mv {}.repo.repo.bak {}.repo
```
### 数值排序
```javascript
sort -t ":" -k 3 -n /etc/passwd
```
### 清理httpd服务日志超过3天的内容
```javascript
0 5 * * * /usr/bin/find /var/log/httpd/ -type f -mtime +3 -exec rm -rf {} \;
```
[三十分钟学会sed](https://github.com/mylxsw/growing-up/blob/master/doc/%E4%B8%89%E5%8D%81%E5%88%86%E9%92%9F%E5%AD%A6%E4%BC%9ASED.md)

[看例子学sed](http://qinghua.github.io/sed/)

[工作中常用的 Linux 命令](https://michael728.github.io/2018/07/05/linux-useful-commands-in-work/)

[工作中常用的 Shell 命令及技巧](https://michael728.github.io/2019/04/14/linux-useful-shell-commands-in-work/)

[PHPer 必知必会的 Linux 命令](https://linux.hellocode.name/user-group.html)

[Linux工具快速教程](https://linuxtools-rst.readthedocs.io/zh_CN/latest/index.html#)

[你可能不知道的shell技巧](https://segmentfault.com/a/1190000016648034)

[wget的15个震撼的例子](https://neuqzxy.github.io/2017/07/08/wget%E7%9A%8415%E4%B8%AA%E9%9C%87%E6%92%BC%E7%9A%84%E4%BE%8B%E5%AD%90/)

[Linux 踩坑记](https://www.restran.net/2015/10/19/linux-practice-notes/)

[PHPer 必知必会的 Linux 命令](https://github.com/Nick233333/phper-linux-gitbook)

[命令行的艺术](https://github.com/jlevy/the-art-of-command-line)

[Nginx 学习笔记时序图](https://www.njphper.com/posts/680ebdf2.html)

[Windows 10 安装体验](https://learnku.com/articles/28500)

[打造高效的工作环境 – SHELL 篇https://github.com/coolshellx/articles](https://coolshell.cn/articles/19219.html)
